#!/usr/bin/env ruby
# frozen_string_literal: true

$LOAD_PATH << File.expand_path("#{File.dirname __FILE__}/../lib")

require 'optparse'
require 'rubygems'
require 'toggl/worktime'

Version = Toggl::Worktime::VERSION
config_file = "#{ENV['HOME']}/.toggl_worktime"
debug = false

opt = OptionParser.new
opt.on('-c CONFIG', '--config CONFIG') { |v| config_file = v }
opt.on('--debug') { |v| debug = v }
opt.parse!(ARGV)

config = Toggl::Worktime::Config.new(path: config_file)
driver = Toggl::Worktime::Driver.new(config: config)
p config if debug

if ARGV.size == 3
  year, month, day = *ARGV.map(&:to_i)
elsif ARGV.size == 2
  year = Time.now.year
  month, day = *ARGV.map(&:to_i)
else
  raise ArgumentError, 'Usage: toggl-worktime [YEAR] MONTH DAY'
end

driver.merge!(year, month, day)
user = driver.me

puts user['fullname']
puts 'worktime'

driver.write

puts "Total worktime: #{driver.total_time}"
